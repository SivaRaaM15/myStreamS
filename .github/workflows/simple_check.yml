name: Simple URL Check

on: [push, workflow_dispatch]

jobs:
  check-urls:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check M3U file and URLs
        run: |
          echo "üîç Checking M3U file..."
          
          if [ ! -f "sivarenu.m3u" ]; then
            echo "‚ùå sivarenu.m3u not found!"
            exit 1
          fi
          
          # Count URLs in the file
          URL_COUNT=$(grep -c "^http" sivarenu.m3u || true)
          echo "üìä Found $URL_COUNT stream URLs"
          
          # Count EXTINF entries
          STREAM_COUNT=$(grep -c "^#EXTINF" sivarenu.m3u || true)
          echo "üì∫ Found $STREAM_COUNT stream entries"
          
          # Show first few URLs as sample
          echo "üîó Sample URLs:"
          grep "^http" sivarenu.m3u | head -5
          
      - name: Install Python dependencies
        run: pip install requests
        
      - name: Validate URLs with Python
        run: |
          python3 -c "
import requests
import re

print('Starting URL validation...')

try:
    with open('sivarenu.m3u', 'r') as f:
        content = f.read()
    
    urls = re.findall(r'^https?://[^\s]+', content, re.MULTILINE)
    print(f'Found {len(urls)} URLs to check')
    
    if not urls:
        print('No URLs found to test')
        exit(0)
    
    print('Testing first 3 URLs...')
    
    for i, url in enumerate(urls[:3]):
        clean_url = url.strip()
        print(f'Testing URL {i+1}: {clean_url[:50]}...')
        
        try:
            response = requests.head(clean_url, timeout=5, allow_redirects=True)
            status = response.status_code
            if status < 400:
                print(f'   ‚úÖ Status: {status}')
            else:
                print(f'   ‚ö†Ô∏è  Status: {status}')
        except requests.exceptions.Timeout:
            print(f'   ‚è∞ Timeout after 5 seconds')
        except requests.exceptions.ConnectionError:
            print(f'   üîå Connection failed')
        except Exception as e:
            print(f'   ‚ùå Error: {type(e).__name__}')
    
    print('URL validation completed')
    
except Exception as e:
    print(f'Error during validation: {e}')
"
